device_tracker:
  - platform: upc_connect
    host: !secret connectbox
    password: !secret connectbox_password
  
owntracks:
  max_gps_accuracy: 1000
  waypoints: false
  events_only: false

sensor:
  - platform: template
    sensors:
      noodles_mood:
        friendly_name: Noodles
        icon_template: mdi:dog
        entity_id: sensor.beat
        value_template: >-
          {#- static input -#}
          {% set static = (([{"Noodles":0,"output":["","","","","",""]},{"Noodles":1,"output":["","Spook? ğŸ‘»","","","",""]},{"Noodles":2,"output":["","","","","",""]},{"Noodles":3,"output":["","","Hallo? â‰","","",""]},{"Noodles":4,"output":["","","","","",""]},{"Noodles":5,"output":["","","","","SPIN!Â¡? ğŸ•·",""]},{"Noodles":6,"output":["","","","","","Gaap! ğŸ¥±"]},{"Noodles":7,"output":["","","","","Koekje! ğŸª",""]},{"Noodles":8,"output":["","","","","Rondje! ğŸƒ","Rondje! ğŸƒ"]},{"Noodles":9,"output":["Eten? ğŸ–'","Eten? ğŸ–'","","Kaas! ğŸ§€","",""]},{"Noodles":10,"output":["","","Kaas! ğŸ§€","","","Kip? ğŸ”"]},{"Noodles":11,"output":["Koekje! ğŸª","","","","",""]},{"Noodles":12,"output":["","Kaas! ğŸ§€","Koekje! ğŸª","","","Kaas! ğŸ§€"]},{"Noodles":13,"output":["Rondje! ğŸƒ","Rondje! ğŸƒ","Rondje! ğŸƒ","Eten? ğŸ–'","Eten? ğŸ–'",""]},{"Noodles":14,"output":["","BLAF ğŸ˜¡","","","",""]},{"Noodles":15,"output":["","Kip? ğŸ”","","","",""]},{"Noodles":16,"output":["TOUWTJE!!! ğŸ§¶","TOUWTJE!!! ğŸ§¶","TOUWTJE!!! ğŸ§¶","TOUWTJE!!! ğŸ§¶","",""]},{"Noodles":17,"output":["","","","","",""]},{"Noodles":18,"output":["","Koekje! ğŸª","","","",""]},{"Noodles":19,"output":["Rondje! ğŸƒ","Rondje! ğŸƒ","Rondje! ğŸƒ","","Eten? ğŸ–'","Eten? ğŸ–'"]},{"Noodles":20,"output":["","","","","Koekje! ğŸª",""]},{"Noodles":21,"output":["TOUWTJE!!! ğŸ§¶","TOUWTJE!!! ğŸ§¶","","","",""]},{"Noodles":22,"output":["","","","","",""]},{"Noodles":23,"output":["","Koekje! ğŸª","","","TOUWTJE!!! ğŸ§¶","TOUWTJE!!! ğŸ§¶"]}])) %}

          {#- Input from HA -#}
          {% set bed_time = states('input_number.bed_hour')|float(23) %}
          {% set wakeup_time = states('input_number.wakeup_hour')|float(7) %}
          {% set persons = states.person %}

          {#- Native functions -#}
          {% set hour = now().hour|int %}
          {% set minute = now().minute|int %}

          {% set person_state = 'home' %}
          {% set night = false if hour in range(wakeup_time,bed_time) else true %}
          {% set anyone_here|d([]) -%}
          {% set pipe = joiner(', ') -%}
          {% for person in persons %}{{ pipe() -}}
          {{ person.state }}{% endfor %}{% endset -%}
          {% set someone_here = true, [anyone_here] if person_state in anyone_here else false %}

          {% set x = static[now().hour].output[now().minute/10|round(0,floor)|int] %}

          {% if x %}
          {{ x }}
          {% elif someone_here and not night %}
          {{ 'spelen? ğŸ¥' }}
          {% else %}
          {{ 'Zzz ğŸ˜´' }}
          {% endif %}
